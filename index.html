<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ULTRON - Assistente Virtual</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCsXT7QaBPdAiBrNlYkgh_12W8V69FU1XI",
      authDomain: "ultron-10a7c.firebaseapp.com",
      projectId: "ultron-10a7c",
      storageBucket: "ultron-10a7c.appspot.com",
      messagingSenderId: "572864287623",
      appId: "1:572864287623:web:18deaae57b184808b23922"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    window.onload = () => {
      const loginBtn = document.getElementById("google-login");
      const logoutBtn = document.getElementById("logout-btn");

      loginBtn.onclick = async () => {
        try {
          await signInWithPopup(auth, provider);
        } catch (error) {
          alert("Erro ao fazer login com o Google.");
        }
      };

      logoutBtn.onclick = async () => {
        await signOut(auth);
        location.reload();
      };

      onAuthStateChanged(auth, user => {
        if (user) {
          document.getElementById("user-name").textContent = user.displayName;
          document.getElementById("user-email").textContent = user.email;
          document.getElementById("profile-toggle").style.display = "block";
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("chat-screen").style.display = "block";
        }
      });
    };

    window.toggleProfile = () => {
      const panel = document.getElementById("profile-panel");
      panel.style.display = panel.style.display === "none" ? "block" : "none";
    };
  </script>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      padding: 20px;
    }
    .input-area {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      padding: 10px;
      background-color: #222;
    }
    input {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 5px;
    }
    button {
      margin-left: 10px;
      padding: 10px;
      border: none;
      background-color: #444;
      color: white;
      border-radius: 5px;
    }
    #profile-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      cursor: pointer;
      display: none;
    }
    #profile-panel {
      display: none;
      position: fixed;
      top: 0;
      right: 0;
      width: 250px;
      height: 100%;
      background: #1e1e1e;
      padding: 20px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.5);
      z-index: 999;
    }
  </style>
</head>
<body>
  <div id="profile-toggle" onclick="toggleProfile()">
    <img src="https://img.icons8.com/ios-filled/50/ffffff/user-male-circle.png" width="32" height="32" />
  </div>

  <div id="profile-panel">
    <h3>Perfil</h3>
    <p><strong>Nome:</strong> <span id="user-name"></span></p>
    <p><strong>Email:</strong> <span id="user-email"></span></p>
    <button id="logout-btn">Sair</button>
    <br><br>
    <button onclick="toggleProfile()">Fechar</button>
  </div>

  <div id="login-screen" class="container">
    <h1>ULTRON - Assistente Virtual</h1>
    <button id="google-login">Entrar com Google</button>
  </div>

  <div id="chat-screen" style="display:none" class="container">
    <div id="chat-area">
      <div class="message bot">Olá! Eu sou o ULTRON. Posso gerenciar sua agenda, te lembrar dos compromissos e informar a previsão do tempo para Santa Izabel do Pará. Pergunte "previsão do tempo".</div>
    </div>

    <div class="input-area">
      <input id="user-input" type="text" placeholder="Digite sua mensagem ou comando" />
      <button onclick="sendMessage()">Enviar</button>
    </div>
  </div>

  <script>
    const chat = document.getElementById("chat-area");
    const userInput = document.getElementById("user-input");

    function addMessage(text, sender = "user") {
      const message = document.createElement("div");
      message.className = `message ${sender}`;
      message.textContent = text;
      chat.appendChild(message);
      chat.scrollTop = chat.scrollHeight;
    }

    async function botResponse(input) {
      if (input.toLowerCase().includes("previsão do tempo")) {
        return "Hoje o tempo está parcialmente nublado em Santa Izabel do Pará.";
      }
      return "Desculpe, ainda estou aprendendo a responder isso.";
    }

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;
      addMessage(text, "user");
      userInput.value = "";
      const response = await botResponse(text);
      addMessage(response, "bot");
    }

    userInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        sendMessage();
      }
    });
  </script>
</body>
</html>
